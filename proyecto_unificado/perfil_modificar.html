<!DOCTYPE html>
<html lang="en">

<head>
    <title>Registro</title>
    <meta charset="utf-8">
    <script src="./libs/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet" href="./libs/bootstrap-3.3.7-dist/css/bootstrap.css">
    <script src="./libs/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/style-index.css">
    <link href="./libs/fontawesome/web-fonts-with-css/css/fontawesome-all.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="../images/favicon.gif" />
    <script> 
        $(function () {
            $("header").load("header.html");
            $("footer").load("footer.html");
        });
    </script>
    <script> 
        var oldPass, newPass, newPass2, phone, email, regExpPass, regExpPhone, regExpEmail, respondePass;
        
        //VALIDACIONES

        //Valida Password
        function validaPassword() {
            oldPass = document.getElementById("oldPass").value,
            newPass = document.getElementById("newPass").value,
            newPass2 = document.getElementById("newPass2").value,
            regExpPass = /(?=^.{8,20}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/;
            
            if(oldPass != "" && newPass != "" && newPass2 != "") {   
                if (regExpPass.test(newPass)) {
                    if (newPass == newPass2) {
                        updatePassword();
                    } else {
                        alert("Las nuevas contraseñas no coinciden");
                    }
                } else {
                    alert("La nueva contraseña no es adecuada. Debe contener al menos una letra mayúscula, una minúscula, un numero y un caracter especial. Longitud de 8 a 20 caracteres");
                }
            }else{
                alert("Los campos contraseña no pueden estar vacios");
            }            
        }
        
        //Valida Teléfono
        function validaPhone() {
            phone = document.getElementById("phone").value,
            regExpPhone = /^[9|6|7][0-9]{8}$/;

            if (phone != "") {
                if (regExpPhone.test(phone)) {
                    updatePhone();
                } else {
                    alert("El campo teléfono no es correcto. Debe comenzar por 9, 7 o 6. La lóngitud máxima son 9 dígitos");
                }
            } else {
                alert("El campo teléfono no puede estar vacio");
            }  
        }

        //Valida Email
        function validaEmail() {
            email = document.getElementById("email").value;
            regExpEmail = /^[_a-z0-9-]+(.[_a-z0-9-]+)*@[a-z0-9-]+(.[a-z0-9-]+)*(.[a-z]{2,4})$/;

            if (email != "") {
                if (regExpEmail.test(email)) {
                    updateEmail();           
                } else {
                    alert("El campo email no es correcto");
                }
            } else {
                alert("El campo email no puede estar vacio");
            }
        }
        
        //UPDATE

        //Actualiza Password
        function updatePassword() {
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "includes/login/updatePass.php", true);
            xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    //document.getElementById("result").innerHTML = this.responseText;
                    alert(this.responseText);
                }
            };
            xhttp.send('oldPass=' + oldPass + '&newPass=' + newPass);
        }
        
        //Actualiza Teléfono
        function updatePhone() {
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "includes/login/updatePhone.php", true);
            xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                   alert(this.responseText);
                }
            };
            xhttp.send('phone=' + phone);
        }

        //Actualiza Email
        function updateEmail() {
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST", "includes/login/updateEmail.php", true);
            xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    alert(this.responseText);
                }
            };
            xhttp.send('email=' + email);
        }

    </script>
</head>

<body>
    <div class="container">
        <header></header>
        <main>
            <h1>Perfil de usuario</h1>
            <hr/>
            <h2>Actualiza Password</h2>
            <hr/>
            <form method="POST">
                <label>Password Antigua:</label>
                <br>
                <input id="oldPass" name="oldPass" type="password" maxlength="100" required>
                <br>
               <label>Password Nueva</label>
                <br>
                <input id="newPass" name="newPass" type="password" maxlength="100" required>
                <br>
                
                <label>Confirmar password Nueva:</label>
                <br>
                <input id="newPass2" name="newPass2" type="password" maxlength="100" required>
                <input type="button" name="button" value="Actualiza Password" onclick="validaPassword()">
                <br>
                <br>
            </form>

            <h2>Actualiza Teléfono</h2>
            <hr/>
            <form>
                <label>Teléfono:</label>
                <br>
                <input id="phone" name="phone" type="text" maxlength="9">
                <input type="button" name="button" value="Actualiza Teléfono" onclick="validaPhone()">
                <br>
                <br>
            </form>

            <h2>Actualiza Email</h2>
            <hr/>
            <form>
                <label>Email:</label>
                <br>
                <input id="email" name="email" type="text" value="esperanza@hotmail.com" maxlength="150" required>
                <input type="button" name="button" value="Actualiza Email" onclick="validaEmail()">
                <br>
                <br>
            </form>
        </main>
        <footer></footer>
    </div>
</body>

</html>